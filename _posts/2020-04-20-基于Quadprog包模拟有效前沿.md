---
layout:     post
title:      基于Quadprog包模拟有效前沿
subtitle:   以四大国有银行为例
date:       2020-04-20
author:     Minjun Huang
header-img: img/tag-bg-o.jpg
catalog: true
tags:
    - R语言
    - 投资学原理
---

<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>

# 两基金分离定理

该定理为作出有效前沿的理论基础。

&emsp;&emsp;对于一个有$n$种资产的投资组合，给定它们的历史*平均*收益率$\boldsymbol{r}=(\tilde{r}\_1,\cdots,\tilde{r}\_n)'$、各资产历史收益率的协方差矩阵$\boldsymbol{V}$及未来某一预期收益率$\text{E}(r)$，则存在权重矩阵$\boldsymbol{w}=(w\_1,\cdots,w\_n)'$使得当$\sum_{i}w\_{i}=1$且$\text{E}(r)=\boldsymbol{w}'\boldsymbol{r}$时，$\displaystyle \frac{1}{2}\boldsymbol{w}'\boldsymbol{Vw}$最小。转换为数学语言即

$$
\min_{\boldsymbol{w}} \frac{1}{2}\boldsymbol{w}'\boldsymbol{Vw}
$$

$$\begin{aligned}
\text{s}.\text{t}.\;&w_1+\cdots +w_n=1
\\
&w_1\tilde{r}_{1}+\cdots +w_{n}\tilde{r}_{n}=\text{E}\left( r \right) 
\end{aligned}
$$

> 证明参考Huang C.F. & Litzenberger R.H.所著的《Foundation for Financial Economics》。

# 在R语言中的实现

### 调取股票数据 

&emsp;&emsp;首先在Tushare平台中调取四大银行在2020-01-01至2020-01-31的收盘价格，并计算出每个银行的日收益率及日收益率的协方差矩阵。

```C++
stock_negative <- list()     
corr <- list()                  

for (i in code_cn$ts_code){
stock_negative[[i]] <- bar(ts_code=i,start_date="20140101",
                end_date='20200407',adj="qfq")
corr[[i]] <- rbind(zgpa,stock_negative[[i]]) %>%
  select(ts_code,trade_date,close) %>% 
  mutate(trade_date = as.Date(trade_date,format="%Y%m%d"),close = as.numeric(close)) %>% 
  group_by(ts_code) %>%
  tq_transmute(
    select=close,
    mutate_fun=dailyReturn,
    col_rename='day_returns'
  ) %>% 
  pivot_wider(names_from='ts_code',values_from='day_returns') %>%
  select(-trade_date) %>%
  na.omit()%>%
  cor()
}
```
